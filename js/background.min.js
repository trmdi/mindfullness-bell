function initBellNotification(){var e=chrome.i18n.getMessage;BellNotification.title=e("BellNotificationTitle"),BellNotification.message=e("BellNotificationMsgIn")+"\n"+e("BellNotificationMsgOut")}function setDataLoadedNhatChuong(){nhatChuongDataLoaded=!0}function setDataLoadedThinhChuong(){thinhChuongDataLoaded=!0}function invitebell(){resetTime(),invitebell2(),isBellEnabled&&chrome.notifications.create(BellNotificationID,BellNotification,function(){})}function invitebell2(){clearTimeout(bell0timer),clearTimeout(bell1timer),clearTimeout(bell2timer),clearTimeout(bell3timer),isBellEnabled&&(bell0timer=setTimeout(nhatchuong,500),numbOfBells>0&&(bell1timer=setTimeout(thinhchuong,5e3),numbOfBells>1&&(bell2timer=setTimeout(thinhchuong,15e3),numbOfBells>2&&(bell3timer=setTimeout(thinhchuong_last,25e3)))))}function nhatchuong(){if(isBellEnabled)if(HTMLver>=5)nhatChuongBell.pause(),thinhChuongBell.pause(),nhatChuongBell.currentTime=0,thinhChuongBell.currentTime=0,nhatChuongBell.play();else{var e='<embed id="MediaPlayer1" showcontrols="0" style="visibility:hidden" showstatusbar="0"';e+=' autostart="true" src = "../bells/c3.mp3" controller="false" volume = "'+.5*document.getElementById("volume").value+'%" SendPlayStateChangeEvents="true"',e+=' SendOpenStateChangeEvents="true" height="0" style="height:0px;" ></embed>',document.getElementById("mediaContainer").innerHTML=e}}function thinhchuong(){if(isBellEnabled)if(HTMLver>=5)nhatChuongBell.pause(),thinhChuongBell.pause(),nhatChuongBell.currentTime=0,thinhChuongBell.currentTime=0,thinhChuongBell.play();else{var e='<embed id="MediaPlayer1" showcontrols="0" style="visibility:hidden" showstatusbar="0"';e+=' autostart="true" src = "../bells/BellofMindfulness.mp3" controller="false" volume = "'+document.getElementById("volume").value+'" SendPlayStateChangeEvents="true"',e+=' SendOpenStateChangeEvents="true" height="0" style="height:0px;"  repeat ="3"></embed>',document.getElementById("mediaContainer").innerHTML=e}}function thinhchuong_last(){if(isBellEnabled)if(HTMLver>=5)nhatChuongBell.pause(),thinhChuongBell.pause(),nhatChuongBell.currentTime=0,thinhChuongBell.currentTime=0,thinhChuongBell.play();else{var e='<embed id="MediaPlayer1" showcontrols="0" style="visibility:hidden" showstatusbar="0"';e+=' autostart="true" src = "../bells/BellofMindfulness.mp3" controller="false" volume = "'+document.getElementById("volume").value+'" SendPlayStateChangeEvents="true"',e+=' SendOpenStateChangeEvents="true" height="0" style="height:0px;"  repeat ="3"></embed>',document.getElementById("mediaContainer").innerHTML=e}chrome.notifications.clear(BellNotificationID,function(){})}function changeTimeSpace(){return isdebug&&console.log("Background: changeTimeSpace is called"),document.getElementById("timespace").value>time_space?(time_space=document.getElementById("timespace").value,void resetTime()):void(60*(time_space-document.getElementById("timespace").value)<timer&&document.getElementById("timespace").value<time_space&&(timer-=60*(time_space-document.getElementById("timespace").value),time_space=document.getElementById("timespace").value))}function changeTimeSpace2(){isdebug&&console.log("Background: changeTimeSpace2 is called"),chrome.storage.local.get("timeSpaceOption",function(e){e.timeSpaceOption>=0&&(time_space_option=e.timeSpaceOption,document.getElementById("timespace").selectedIndex=time_space_option,changeTimeSpace())}),isdebug&&console.log("Background: done changeTimeSpace2 is called")}function updateTime(){chrome.storage.local.get("isBellEnabled",function(e){e.isBellEnabled?(isBellEnabled||(timer=1,isBellEnabled=!0),timer--,writeTime(),chrome.storage.local.set({TimeRemain:timer},function(){}),chrome.storage.local.get("volumeChanged",function(e){isdebug&&console.log("Background: Checking for volume change",e),e.volumeChanged&&(changeVolume2(),isdebug&&console.log("volume"+volume),chrome.storage.local.set({volumeChanged:!1},function(){isdebug&&console.log("Background: Saved volumeChanged to false")}))}),chrome.storage.local.get("numBellsChanged",function(e){isdebug&&console.log("Background: Checking for number of bells change",e),e.numBellsChanged&&(chrome.storage.local.get("numbOfBells",function(e){numbOfBells=e.numbOfBells,document.getElementById("numOfBells").selectedIndex=numbOfBells}),isdebug&&console.log("volume"+volume),chrome.storage.local.set({numBellsChanged:!1},function(){isdebug&&console.log("Background: Saved numBellsChanged to false")}))}),chrome.storage.local.get("timeSpaceChanged",function(e){isdebug&&console.log("Background: Checking for timeSpaceChanged",e),e.timeSpaceChanged&&(changeTimeSpace2(),chrome.storage.local.set({timeSpaceChanged:!1},function(){isdebug&&console.log("Background: Saved timeSpaceChanged to false")}))}),chrome.storage.local.get("doRingBell",function(e){e.doRingBell&&(isdebug&&console.log("Background: doRingBell",e.doRingBell),chrome.storage.local.set({doRingBell:!1},function(){}),invitebell2(),chrome.notifications.create(BellNotificationID,BellNotification,function(){}))}),0>=timer&&invitebell()):(timer=0,chrome.storage.local.set({TimeRemain:timer},function(){}),chrome.browserAction.setBadgeText({text:"OFF"}),chrome.browserAction.setBadgeBackgroundColor({color:"#e56524"}),isdebug&&console.log("Background: isBellEnabled: ",e.isBellEnabled)),isBellEnabled=e.isBellEnabled}),setTimeout(updateTime,1e3)}function resetTime(){timer=60*time_space}function writeTime(){var e="",n="";e+=""+Math.floor(timer/60),1==e.length&&(e="0"+e),e+=":",n+=timer%60,1==n.length&&(n="0"+n),e+=n,document.getElementById("timeleft").value=e,chrome.browserAction.setBadgeText({text:e}),chrome.browserAction.setBadgeBackgroundColor({color:"#e56524"})}function changeVolume(){volume=document.getElementById("volume").value,document.getElementById("volume_txt").value=""+document.getElementById("volume").value+"%",HTMLver>=5&&(nhatChuongBell.volume=document.getElementById("volume").value/100,thinhChuongBell.volume=document.getElementById("volume").value/100)}function changeVolume2(){chrome.storage.local.get("volume",function(e){e.volume>=0&&(volume=e.volume,document.getElementById("volume").value=e.volume,isdebug&&console.log("Background: Volume set to "+volume),changeVolume())})}function setBellEnable(){isBellEnabled=document.getElementById("isBellEnabledSwitch").checked,isdebug&&console.log("Background: isBellEnabled: "+isBellEnabled),isBellEnabled?(document.getElementById("onLayer").style.visibility="visible",document.getElementById("onLayer").style.display="block",document.getElementById("offLayer").style.visibility="hidden",document.getElementById("offLayer").style.display="none"):(document.getElementById("offLayer").style.visibility="visible",document.getElementById("offLayer").style.display="block",document.getElementById("onLayer").style.visibility="hidden",document.getElementById("onLayer").style.display="none"),chrome.storage.local.set({isBellEnabled:isBellEnabled},function(){isdebug&&console.log("Background: Saved isBellEnabled")})}function getHtmlVer(){var e=navigator.appCodeName,n=navigator.userAgent,t=0;for(n=n.substring((n+e).toLowerCase().indexOf(e.toLowerCase())),n=n.substring(e.length);" "==n.substring(0,1)||"/"==n.substring(0,1);)n=n.substring(1);for(var l=0;"0123456789.+-".indexOf((n+"?").substring(l,l+1))>=0;)l+=1;return n=n.substring(0,l),isNaN(n)||n>0&&(t=n),t}function updateData(){document.getElementById("isBellEnabledSwitch").checked=isBellEnabled,document.getElementById("offLayer").style.height=document.getElementById("onLayer").offsetHeight,document.getElementById("numOfBells").selectedIndex=numbOfBells,setBellEnable(),changeTimeSpace2(),changeVolume2(),isdebug&&console.log("UpdateNow")}function setLocalization(){var e=chrome.i18n.getMessage;document.title=e("bellTitle"),$("#bellTitle").each(function(){this.innerHTML=e("bellTitle")}),$("#RemainingTime").each(function(){this.innerHTML=e("RemainingTime"),this.title=e("RemainingTime_Tooltip")}),$("#TimeBetweenBells").each(function(){this.innerHTML=e("TimeBetweenBells"),this.title=e("TimeBetweenBells_Tooltip")}),$("#_5min_").each(function(){this.innerHTML=e("_5min_")}),$("#_10min_").each(function(){this.innerHTML=e("_10min_")}),$("#_15min_").each(function(){this.innerHTML=e("_15min_")}),$("#_20min_").each(function(){this.innerHTML=e("_20min_")}),$("#_30min_").each(function(){this.innerHTML=e("_30min_")}),$("#_45min_").each(function(){this.innerHTML=e("_45min_")}),$("#_60min_").each(function(){this.innerHTML=e("_60min_")}),$("#VolumeLabel").each(function(){this.innerHTML=e("VolumeLabel"),this.title=e("Volume_Tooltip")}),$("#invitebell").each(function(){this.value=e("InviteBell")}),$("#BellIsOff").each(function(){this.innerHTML=e("BellIsOff")}),$("#BellOfMindfulnessPurpose").each(function(){this.innerHTML=e("BellOfMindfulnessPurpose")}),$("#DesignCredit").each(function(){this.innerHTML=e("DesignCredit")}),$("#ExtAuthor").each(function(){this.innerHTML=e("extAuthor")}),$("#TranslateCredit").each(function(){this.innerHTML=e("TranslateCredit")}),$("#InspirationTxt").each(function(){this.innerHTML=e("InspirationTxt")}),$("#InspirationCredit").each(function(){this.innerHTML=e("InspirationCredit")}),$("#isBellEnabledSwitch").each(function(){this.title=e("isBellEnabledSwitch_Tooltip"),$(this).children().each(function(){this.title=e("isBellEnabledSwitch_Tooltip"),$(this).children().each(function(){this.title=e("isBellEnabledSwitch_Tooltip")})})}),$("#timeleft").each(function(){this.title=e("RemainingTime_Tooltip")}),$("#timespace").each(function(){this.title=e("TimeBetweenBells_Tooltip")}),$("#volume").each(function(){this.title=e("Volume_Tooltip")}),$("#volume_txt").each(function(){this.title=e("Volume_Tooltip")}),$("#invitebell").each(function(){this.title=e("InviteBell_Tooltip")})}function loadData(){var e=new Array;e[0]="timeSpaceOption",e[1]="volume",e[2]="isBellEnabled",e[3]="numbOfBells";try{chrome.storage.local.get(e,function(e){null==e.timeSpaceOption?chrome.storage.local.set({timeSpaceOption:time_space_option},function(){isdebug&&console.log("Background: Saved time_space_option")}):(time_space_option=e.timeSpaceOption,isdebug&&console.log("Background: timeSpaceOption",e.timeSpaceOption)),null==e.numbOfBells||e.numbOfBells<0?chrome.storage.local.set({numbOfBells:numbOfBells},function(){isdebug&&console.log("Background: Saved numbOfBells")}):(numbOfBells=e.numbOfBells,document.getElementById("numOfBells").selectedIndex=numbOfBells,isdebug&&console.log("Background: numbOfBells",e.numbOfBells)),null==e.volume?chrome.storage.local.set({volume:volume},function(){isdebug&&console.log("Background: Saved volume")}):(volume=e.volume,isdebug&&console.log("Background: volume: ",e.volume)),null==e.isBellEnabled?chrome.storage.local.set({isBellEnabled:isBellEnabled},function(){isdebug&&console.log("Background: Saved isBellEnabled")}):(isBellEnabled=e.isBellEnabled,isdebug&&console.log("Background: isBellEnabled: ",isBellEnabled)),updateData(),initTimer()})}catch(n){isdebug&&console.log("Background: Cannot get local storage"),chrome.storage.local.set({timeSpaceOption:time_space_option},function(){isdebug&&console.log("Background: Saved time_space_option")}),chrome.storage.local.set({numbOfBells:numbOfBells},function(){isdebug&&console.log("Background: Saved numbOfBells")}),chrome.storage.local.set({volume:volume},function(){isdebug&&console.log("Background: Saved volume")}),chrome.storage.local.set({isBellEnabled:isBellEnabled},function(){isdebug&&console.log("Background: Saved isBellEnabled")})}}function playIt(){nhatChuongDataLoaded&&nhatChuongDataLoaded?(invitebell(),updateTime()):setTimeout(playIt,100)}function initTimer(){chrome.storage.local.set({timeSpaceChanged:!1},function(){isdebug&&console.log("Background: Set timeSpaceChanged to false")}),chrome.storage.local.set({numBellsChanged:!1},function(){isdebug&&console.log("Background: Set numBellsChanged to false")}),chrome.storage.local.set({doRingBell:!1},function(){isdebug&&console.log("Background: Set doRingBell to false")}),chrome.storage.local.set({volumeChanged:!1},function(){isdebug&&console.log("Background: Set volumeChanged to false")}),HTMLver>=5?playIt():(invitebell(),updateTime())}var isBellEnabled=!0,nhatChuongDataLoaded=!1,thinhChuongDataLoaded=!1,nhatChuongBell=document.getElementById("nhatChuong"),thinhChuongBell=document.getElementById("thinhChuong"),time_space_option=2,volume=30,timer=0,time_space=3,timer_str="",volume=document.getElementById("volume").value,numbOfBells=3,bell0timer=null,bell1timer=null,bell2timer=null,bell3timer=null,HTMLver=getHtmlVer(),isdebug=!1,BellNotification={type:"basic",iconUrl:"../icons/icon.png",title:"Breathe, my dear...",message:"In  -  I know I am breathing in.\nOut  -  I know I am breathing out."},BellNotificationID="BellNotification";document.addEventListener("DOMContentLoaded",function(){setLocalization(),HTMLver>=5&&(nhatChuongBell.oncanplaythrough=setDataLoadedNhatChuong(),thinhChuongBell.oncanplaythrough=setDataLoadedThinhChuong()),loadData()});